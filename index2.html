<!DOCTYPE html>
<html>
<title> Interactive Heat Map </title>

  <head>

    <style type="text/css">
    html, body,
    #map-canvas1 {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    #map-canvas2 {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    </style>
    <!-- #header {
        padding:5px;
        margin: auto;
    }
    #footer {
        padding:15px;
        margin: auto;
    } -->

    <script type="text/javascript" src="./jquery-2.1.3.min.js"></script>

    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC4SPbDlN0XvyPEJFZhDhd8hQ0whisSD7Q&libraries=visualization&sensor=false">
    </script>

    <script type="text/javascript">

      function initialize() {

        var mapOptions = {
          center: {lat: 40.1430058, lng: -74.7311156},
          zoom: 8
        };

        var map1 = new google.maps.Map(document.getElementById('map-canvas1'),
            mapOptions);
        var map2 = new google.maps.Map(document.getElementById('map-canvas2'),
            mapOptions);

        // If anything is plotted:
        if (location.search) {

          // Get submitted parameters.
          var params = {};

          var parts = location.search.substring(1).split('&');

          for (var i = 0; i < parts.length; i++) {
            var nv = parts[i].split('=');
            params[i] = nv[1];
          }

          var hrs1  = parseInt(params[0]);
          var mins1 = parseInt(params[1]);
          var ampm1 = parseInt(params[2]);
          var hrs2  = parseInt(params[3]);
          var mins2 = parseInt(params[4]);
          var ampm2 = parseInt(params[5]);
          var typ1  = params[6];
          var typ2  = params[7];
          var typfile1 = typ1+".csv";
          var typfile2 = typ1+".csv";

          // Change auto fields.
          $("#hl_"+params[0]).attr("selected","selected");
          $("#ml_"+params[1]).attr("selected","selected");
          $("#modl_"+params[2]).attr("selected","selected");
          $("#typel_"+typ1).attr("checked","checked");
          $("#hr_"+params[3]).attr("selected","selected");
          $("#mr_"+params[4]).attr("selected","selected");
          $("#modr_"+params[5]).attr("selected","selected");
          $("#typer_"+typ2).attr("checked","checked");

          //var hrs = location.search.split('Hour=')[1]
          //var mins = document.forms["myForm"]["Min"].value;
          //var ampm = document.forms["myForm"]["Mod"].value;
          //var typ  = document.forms["myForm"]["Type"].value;

          // Plot Pixel polygons.

          // var pixel;

          // // Define the LatLng coordinates for the pixel's outline.
          // var pixelCoords = [
          //   new google.maps.LatLng(40.630810, -74.368949),//myhouse
          //   new google.maps.LatLng(40.344185, -74.651427),//pu
          //   new google.maps.LatLng(40.137298, -74.440258),//6flags
          //   new google.maps.LatLng(40.346697, -74.065025)//redbank
          // ];

          // // Construct the pixel.
          // pixel = new google.maps.Polygon({
          //   paths: pixelCoords,
          //   strokeColor: '#FF0000',
          //   strokeOpacity: hrs/11.,
          //   strokeWeight: 2,
          //   fillColor: '#FF0000',
          //   fillOpacity: mins/50.
          // });

          // pixel.setMap(map);

          // Create heat map data.
          var heatMapData1 = [];
          var heatMapData2 = [];

          // Read in data.
          $(document).ready(function() {
            $.ajax({
              type: "GET",
              url: typfile1,
              dataType: "text",
              success: function(data) {processData1(data);}
            });
          });

          $(document).ready(function() {
            $.ajax({
              type: "GET",
              url: typfile2,
              dataType: "text",
              success: function(data) {processData2(data);}
            });
          });

          function processData1(allText) {
            var allTextLines = allText.split(/\r\n|\n/);
            var lines = [];

            for (var i = 0; i < allTextLines.length; i++) {
              var data = allTextLines[i].split(',');
              var oY = data[0];
              var oX = data[1];
              heatMapData1[i] = {location: new google.maps.LatLng(38.9+parseInt(oY)/138.2, -75.6+parseInt(oX)/108.907), weight: data[2+72*ampm1+6*hrs1+mins1]};
            }

            var heatmap1 = new google.maps.visualization.HeatmapLayer({
              data: heatMapData1,
              dissipating: true,
              maxIntensity: typ1==="indiv" ? 1000 : 300
            });
            heatmap1.setMap(map1);
          }

          function processData2(allText) {
            var allTextLines = allText.split(/\r\n|\n/);
            var lines = [];

            for (var i = 0; i < allTextLines.length; i++) {
              var data = allTextLines[i].split(',');
              var oY = data[0];
              var oX = data[1];
              heatMapData2[i] = {location: new google.maps.LatLng(38.9+parseInt(oY)/138.2, -75.6+parseInt(oX)/108.907), weight: data[2+72*ampm2+6*hrs2+mins2]};
            }

            var heatmap2 = new google.maps.visualization.HeatmapLayer({
              data: heatMapData2,
              dissipating: true,
              maxIntensity: typ2==="indiv" ? 1000 : 300
            });
            heatmap2.setMap(map2);
          }
        }
      }

      google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>

  <body bgcolor="4C4646">

    <!-- Above Maps -->
    <!-- <div id="header"> -->
    <center>

      <h3 style="color:#F58025"> Interactive Arrival Rate Heat Map </h3>

      <form name=myForm METHOD=GET style="color:#FFFFFF">
      Left:
      <select name=Hourl>
        <option id="hl_0" value=0>12</option><option id="hl_1" value=1>1</option><option id="hl_2" value=2>2</option><option id="hl_3" value=3>3</option><option id="hl_4" value=4>4</option><option id="hl_5" value=5>5</option><option id="hl_6" value=6>6</option><option id="hl_7" value=7>7</option><option id="hl_8" value=8>8</option><option id="hl_9" value=9>9</option><option id="hl_10" value=10>10</option><option id="hl_11" value=11>11</option>
      </select>
      <select name=Minl>
        <option id="ml_0" value=0>00-09</option><option id="ml_1" value=1>10-19</option><option id="ml_2" value=2>20-29</option><option id="ml_3" value=3>30-39</option><option id="ml_4" value=4>40-49</option><option id="ml_5" value=5>50-59</option>
      </select>
      <select name=Modl>
        <option id="modl_0" value=0>AM</option><option id="modl_1" value=1>PM</option>
      </select>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Right:
      <select name=Hourr>
        <option id="hr_0" value=0>12</option><option id="hr_1" value=1>1</option><option id="hr_2" value=2>2</option><option id="hr_3" value=3>3</option><option id="hr_4" value=4>4</option><option id="hr_5" value=5>5</option><option id="hr_6" value=6>6</option><option id="hr_7" value=7>7</option><option id="hr_8" value=8>8</option><option id="hr_9" value=9>9</option><option id="hr_10" value=10>10</option><option id="hr_11" value=11>11</option>
      </select>
      <select name=Minr>
        <option id="mr_0" value=0>00-09</option><option id="mr_1" value=1>10-19</option><option id="mr_2" value=2>20-29</option><option id="mr_3" value=3>30-39</option><option id="mr_4" value=4>40-49</option><option id="mr_5" value=5>50-59</option>
      </select>
      <select name=Modr>
        <option id="modr_0" value=0>AM</option><option id="modr_1" value=1>PM</option>
      </select>
      <p>
      <!-- Time (hhm0): <input type=text name=Time size=4> <p> -->
      Left Arrival Type: <input id="typel_indiv" type=radio name=Typel value="indiv" checked=checked> Individuals
                    <input id="typel_units" type=radio name=Typel value="units"> "Departure Units"
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Right Arrival Type: <input id="typer_indiv" type=radio name=Typer value="indiv"> Individuals
                    <input id="typer_units" type=radio name=Typer value="units" checked=checked> "Departure Units"
      <p>
      <!-- <input type=submit> -->
      <button>Plot</button>

      <br><br>
      <a href="plots.html?oX=125&oY=65&Type=overlay" style="color: #52D017">Go to Interactive Arrival Rate Plots</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="index.html" style="color: #52D017">* 1 Map *</a>

    </center>
    
    <div style="width: 100%; height: 75%; overflow: hidden;">
      <!-- Left Map -->
      <div id="map-canvas1" style="width: 50%; height: 100%; float: left; margin: 0px;"></div>
      <!-- <br style="clear:both;"/> -->
      <!-- Right Map -->
      <div id="map-canvas2" style="margin-left: 50%; height: 100%; margin: 0px"></div>
      <!-- <br style="clear:both;"/> -->
    </div>

    <!-- <div id="footer"> -->
    <center>
    <h5 style="color:#F58025">Kyle Douglas, 2015</h5>
    </center>
    <!-- </div> -->

  </body>
</html>